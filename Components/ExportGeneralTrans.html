<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>General Transit Export</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-DQvkBjpPgn7RC31MCQoOeC9TI2kdqa4+BSgNMNj8v77fdC77Kj5zpWFTJaaAoMbC" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style_ExportGeneralTrans.css">

</head>

<body>
    <!-- Header-->
    <section class="header-bottom">
        <nav class="navbar navbar-expand-lg navbar-light bg-light py-0 fixed-top">
            <div class="container-fluid d-flex align-items-center justify-content-between">

                <!-- Logo a sinistra -->
                <a class="navbar-brand mx-0" href="Versioni_Orario.html">
                    <img src="..\Icons\Logo_IVU.png"
                         alt="Logo" width="200" height="100">
                </a>

                <!-- Menu centrale -->
                <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false">
                                Amministrazione
                            </a>
                            <ul class="dropdown-menu w-100 list-inline text-center" aria-labelledby="navbarDropdownMenuLink">
                                <li class="list-inline-item">
                                    <a class="dropdown-item" href="#"><img src="" alt=""></a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="dropdown-item" href="#"><img src="" alt=""></a>
                                </li>
                                <li class="list-inline-item">
                                    <a class="dropdown-item" href="#"><img src="" alt=""></a>
                                </li>
                            </ul>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false">
                                Import
                            </a>
                            <ul class="dropdown-menu w-100 list-inline text-center" aria-labelledby="navbarDropdownMenuLink">
                                <li class="list-inline-item"><a class="dropdown-item" href="#">Hafas</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="#">Isa</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="#">railML</a></li>
                            </ul>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false">
                                Impostazione di base
                            </a>
                            <ul class="dropdown-menu w-100 list-inline text-center" aria-labelledby="navbarDropdownMenuLink">
                                <li class="list-inline-item"><a class="dropdown-item" href="#">Opzione 1</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="#">Opzione 2</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="#">Opzione 3</a></li>
                            </ul>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false">
                                Gestione Dati
                            </a>
                            <ul class="dropdown-menu w-100 list-inline text-center" aria-labelledby="navbarDropdownMenuLink">
                                <li class="list-inline-item"><a class="dropdown-item" href="Linee.html">Linee</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="Versioni_Orario.html">Versioni orario</a></li>
                            </ul>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                               aria-expanded="false">
                                Export
                            </a>
                            <ul class="dropdown-menu w-100 list-inline text-center" aria-labelledby="navbarDropdownMenuLink">
                                <li class="list-inline-item"><a class="dropdown-item" href="#">Hafas</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="#">Isa</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="#">IVU.pool</a></li>
                                <li class="list-inline-item"><a class="dropdown-item" href="ExportGeneralTrans.html">General Transit</a></li>
                            </ul>
                        </li>

                    </ul>
                </div>

                <!-- Bottone "Accedi" a destra -->
                <div class="d-flex align-items-center">
                    <button type="button" class="btn btn-dark rounded-pill me-2">Accedi</button>
                    <i class="fas fa-search"></i>
                </div>
            </div>
        </nav>
    </section>
    <!-- Main-->

    <div class="container-fluid mt-16">
        <div class="row">
            <div class="col-md-6">
                <div class="filter-section">
                    <h5>Supplier selection</h5>
                    <input type="text" class="form-control mb-2" placeholder="Cerca..." id="search-company">
                    <div class="list-box" id="company-list-box">
                        <div class="list-box-header">
                            <span>Supplier short identifier</span>
                            <span>Supplier name Ident</span>
                        </div>
                        <div class="list-box-content" id="company-list-content">
                            <div class="list-box-item" data-id="LA"><span>FornitoreDatiOr... T</span><span>LA</span><span>30</span></div>
                            <div class="list-box-item" data-id="LO"><span>FornitoreDatiOr... T</span><span>LO</span><span>407</span></div>
                            <div class="list-box-item" data-id="MA"><span>FornitoreDatiOr... T</span><span>MA</span><span>12</span></div>
                            <div class="list-box-item" data-id="MO"><span>FornitoreDatiOr... T</span><span>MO</span><span>125</span></div>
                            <div class="list-box-item" data-id="PI"><span>FornitoreDatiOr... T</span><span>PI</span><span>155</span></div>
                            <div class="list-box-item" data-id="PU"><span>FornitoreDatiOr... T</span><span>PU</span><span>73</span></div>
                            <div class="list-box-item" data-id="RA"><span>FornitoreDatiOr... T</span><span>RA</span><span>302</span></div>
                            <div class="list-box-item" data-id="SA"><span>FornitoreDatiOr... T</span><span>SA</span><span>111</span></div>
                            <div class="list-box-item" data-id="SI"><span>FornitoreDatiOr... T</span><span>SI</span><span>190</span></div>
                            <div class="list-box-item" data-id="TN"><span>FornitoreDatiOr... T</span><span>TN</span><span>47</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="filter-section">
                    <h5>Division selection</h5>
                    <input type="text" class="form-control mb-2" placeholder="Cerca..." id="search-routes">
                    <div class="list-box" id="routes-list-box">
                        <div class="list-box-header">
                            <span>Supplier short identifier</span>
                            <span>Supplier name</span>
                            <span>Company name</span>
                            <span>Division short identifier</span>
                        </div>
                        <div class="list-box-content" id="routes-list-content">
                            <div class="list-box-item" style="justify-content: center; color: #6c757d;"><span>Seleziona una compagnia/divisione</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <div class="container-fluid">
        <div class="table-wrapper">
            <h5>Route selection</h5>
            <div class="checkbox-group">
                <input type="checkbox" id="export-routes" checked>
                <label for="export-routes">Export all routes that are not explicitly deselected</label>
            </div>
            
                <table class="table table-bordered">
                    <thead class="thead-light">
                        <tr>
                            <th>Supplier short identifier</th>
                            <th>Supplier name</th>
                            <th>Company name</th>
                            <th>Division short identifier</th>
                            <th>Division name</th>
                            <th>Internal name</th>
                            <th>Public name</th>
                            <th>Glob</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore DatiOrario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH</td>
                            <td>DP - LH_</td>
                            <td>00139</td>
                            <td>139</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore DatiOrario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH</td>
                            <td>DP - LH_</td>
                            <td>00141</td>
                            <td>141</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore Dati Orario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH</td>
                            <td>DP - LH</td>
                            <td>00143</td>
                            <td>143</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore Dati Orario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH</td>
                            <td>DP - LH</td>
                            <td>00145</td>
                            <td>145</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore Dati Orario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH_</td>
                            <td>DP - LH</td>
                            <td>00147</td>
                            <td>147</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore DatiOrario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH</td>
                            <td>DP - LH</td>
                            <td>00158</td>
                            <td>158</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore Dati Orario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH</td>
                            <td>DP - LH_</td>
                            <td>00036</td>
                            <td>36</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>FDO</td>
                            <td>Fornitore Dati Orario</td>
                            <td>TRENITALIA</td>
                            <td>DP - LH</td>
                            <td>DP - LH</td>
                            <td>00037</td>
                            <td>37</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="button-bar">

            <button class="btn btn-primary">Export</button>
            <button>Quit</button>
        </div>



    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // --- DATI DUMMY ---
        // Associa lo "Short Ident" (data-id) a un array di oggetti Route
        const routeData = {
            'LA': [
                { name: '00500', publicName: '500', company: 'TI' },
                { name: '00508', publicName: '508', company: 'TI' }
            ],
            'LO': [
                { name: '00509', publicName: '509', company: 'TI' },
                { name: '00510', publicName: '510', company: 'TI' }
            ],
            'MA': [{ name: '00511', publicName: '511', company: 'TI' }],
            'MO': [{ name: '00519', publicName: '519', company: 'TI' }],
            'PI': [
                { name: '00580', publicName: '580', company: 'TI' },
                { name: '00583', publicName: '583', company: 'TI' }
            ],
            'PU': [{ name: '00590', publicName: '590', company: 'TI' }],
            'RA': [{ name: '00596', publicName: '596', company: 'TI' }],
            'SA': [ /* Nessuna rotta per SA (esempio) */],
            'SI': [{ name: '00601', publicName: '601', company: 'SI' }, { name: '00602', publicName: '602', company: 'SI' }],
            'TN': [{ name: '00700', publicName: '700', company: 'TN' }],
        };

        // Attende che il DOM sia caricato
        document.addEventListener('DOMContentLoaded', function () {

            const companyListContent = document.getElementById('company-list-content');
            const routesListContent = document.getElementById('routes-list-content');
            const timelineContainer = document.querySelector('.timeline-container'); // Selettore di classe

            // --- FUNZIONI ---
            function populateRoutes(companyId) {
                // Pulisce la lista rotte attuale
                routesListContent.innerHTML = '';
                // Nasconde la timeline se una nuova compagnia viene selezionata
               // hideTimeline();
                const selectedRoute = routesListContent.querySelector('.list-box-item.selected');
                if (selectedRoute) {
                    selectedRoute.classList.remove('selected');
                }
                const routes = routeData[companyId] || []; // Prende le rotte o un array vuoto

                if (routes.length === 0) {
                    routesListContent.innerHTML = '<div class="list-box-item" style="justify-content: center; color: #6c757d;"><span>Nessuna rotta trovata</span></div>';
                    return; // Esce se non ci sono rotte
                }

                routes.forEach(route => {
                    const item = document.createElement('div');
                    item.classList.add('list-box-item');
                    // Aggiungi un data attribute se necessario per identificare la rotta
                    // item.setAttribute('data-route-name', route.name);
                    item.innerHTML = `
                                         <span>${route.name}</span>
                                         <span>${route.publicName}</span>
                                         <span>${route.company}</span>
                                     `;
                    routesListContent.appendChild(item);
                });

                // Rimuove eventuali listener precedenti e aggiunge il nuovo per le rotte
                // (necessario perch� il contenuto � stato rigenerato)
                routesListContent.removeEventListener('click', handleRouteClick); // Rimuove vecchio listener
                routesListContent.addEventListener('click', handleRouteClick); // Aggiunge nuovo listener
            }

            function showTimeline() {
                if (timelineContainer) {
                    timelineContainer.style.display = 'block'; // O 'flex', 'grid' se usi layout specifici
                }
            }

            function hideTimeline() {
                if (timelineContainer) {
                    timelineContainer.style.display = 'none';
                }
                // Deseleziona eventuali rotte selezionate
                const selectedRoute = routesListContent.querySelector('.list-box-item.selected');
                if (selectedRoute) {
                    selectedRoute.classList.remove('selected');
                }
            }

            function handleCompanyClick(event) {
                // Trova l'elemento .list-box-item pi� vicino che � stato cliccato
                const targetItem = event.target.closest('.list-box-item');
                if (!targetItem) return; // Non fare nulla se il click non � su un item

                // Rimuovi la classe 'selected' da tutti gli elementi nella lista compagnie
                companyListContent.querySelectorAll('.list-box-item').forEach(item => {
                    item.classList.remove('selected');
                });
                // Aggiungi 'selected' all'elemento cliccato
                targetItem.classList.add('selected');

                const companyId = targetItem.getAttribute('data-id');
                populateRoutes(companyId);
            }

            function handleRouteClick(event) {
                // Trova l'elemento .list-box-item pi� vicino che � stato cliccato
                const targetItem = event.target.closest('.list-box-item');
                if (!targetItem || targetItem.textContent === 'Nessuna rotta trovata' || targetItem.textContent === 'Seleziona una compagnia/divisione') return; // Ignora click su messaggi o non-item

                // Rimuovi la classe 'selected' da tutti gli elementi nella lista rotte
                routesListContent.querySelectorAll('.list-box-item').forEach(item => {
                    item.classList.remove('selected');
                });
                // Aggiungi 'selected' all'elemento cliccato
                targetItem.classList.add('selected');

                showTimeline();
            }


            // --- EVENT LISTENERS INIZIALI ---
            if (companyListContent) {
                companyListContent.addEventListener('click', handleCompanyClick);
            }

            // Aggiunta funzionalit� di ricerca (opzionale, base)
            const searchCompanyInput = document.getElementById('search-company');
            const searchRoutesInput = document.getElementById('search-routes');

            if (searchCompanyInput && companyListContent) {
                searchCompanyInput.addEventListener('keyup', () => {
                    const filter = searchCompanyInput.value.toUpperCase();
                    const items = companyListContent.getElementsByClassName('list-box-item');
                    for (let i = 0; i < items.length; i++) {
                        const spans = items[i].getElementsByTagName('span');
                        let txtValue = '';
                        for (let j = 0; j < spans.length; j++) {
                            txtValue += spans[j].textContent || spans[j].innerText;
                        }
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            items[i].style.display = "";
                        } else {
                            items[i].style.display = "none";
                        }
                    }
                });
            }

            if (searchRoutesInput && routesListContent) {
                searchRoutesInput.addEventListener('keyup', () => {
                    const filter = searchRoutesInput.value.toUpperCase();
                    const items = routesListContent.getElementsByClassName('list-box-item');
                    for (let i = 0; i < items.length; i++) {
                        const spans = items[i].getElementsByTagName('span');
                        let txtValue = '';
                        for (let j = 0; j < spans.length; j++) {
                            txtValue += spans[j].textContent || spans[j].innerText;
                        }
                        if (txtValue.toUpperCase().indexOf(filter) > -1 || items[i].textContent === 'Nessuna rotta trovata' || items[i].textContent === 'Seleziona una compagnia/divisione') { // Non filtrare i messaggi
                            items[i].style.display = "";
                        } else {
                            items[i].style.display = "none";
                        }
                    }
                });
            }

        });
    </script>

    <!-- Footer-->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YUe2LzesAfftltw+PEaao2tjU/QATaW/rOitAq67e0CT0Zi2VVRL0oC4+gAaeBKu"
            crossorigin="anonymous"></script>

</body>

</html>
